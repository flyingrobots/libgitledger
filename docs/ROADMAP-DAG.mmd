%%{init: { 'theme': 'base', 'flowchart': { 'useMaxWidth': true, 'nodeSpacing': 50, 'rankSpacing': 60 } }}%%
flowchart TD
  %% Corrected DAG: 80 edges, 0 cycles, complete dependencies
  %% Generated by dependency analysis

  subgraph Phase1["Phase 1: Foundation (3w)"]
    N31["N31: CRoaring vendor"]
    N37["N37: BLAKE3 vendor"]
    N4["N4: CI scaffolding"]
    N47["N47: Minimal Linux CRT shim"]
    N51["N51: Doxygen config"]
    N6["N6: Error API"]
    N7["N7: Allocator hooks"]
    N8["N8: Logger hooks"]
    N9["N9: Context lifecycle"]
  end

  subgraph Phase2["Phase 2: Interfaces (2w)"]
    N10["N10: Git repo port interface"]
    N17["N17: Policy parser"]
    N18["N18: Author identity port"]
    N22["N22: Signature port"]
    N30["N30: Indexer interface"]
    N50["N50: Public API docs"]
    N52["N52: Annotate headers"]
    N53["N53: CI docs upload"]
    N58["N58: Windows DLL audit"]
    N59["N59: Fuzzing harness"]
    N61["N61: Symbol policy"]
    N62["N62: Audit exports"]
    N64["N64: MSVC printf fix"]
  end

  subgraph Phase3["Phase 3: Git Adapter (4w) ⚠️ CRITICAL"]
    N11["N11: libgit2 adapter"]
    N54["N54: CLI scaffold"]
    N55["N55: CLI framework"]
    N63["N63: MSVC build"]
    N65["N65: error_json fuzzer"]
    N66["N66: version fuzzer"]
    N68["N68: Adapter header"]
    N71["N71: Linux symbols"]
    N72["N72: macOS symbols"]
    N73["N73: Windows symbols"]
  end

  subgraph Phase4["Phase 4: Core Features (5w)"]
    N12["N12: Ledger lifecycle"]
    N16["N16: Policy document storage"]
    N21["N21: Trust storage"]
    N23["N23: Signature validation"]
    N56["N56: version command"]
    N57["N57: error-demo command"]
    N60["N60: Extended adapter"]
    N67["N67: Fuzzing CI"]
  end

  subgraph Phase5["Phase 5: Operations (4w)"]
    N13["N13: Append path"]
    N14["N14: Read path"]
    N24["N24: Attestation support"]
    N25["N25: Threshold enforcement"]
    N26["N26: Notes API"]
    N27["N27: Tag association"]
    N69["N69: Open repo fixtures"]
  end

  subgraph Phase6["Phase 6: Indexing (5w) ⚠️ COMPLEX"]
    N15["N15: Append/read integration tests"]
    N19["N19: Append enforcement"]
    N28["N28: CLI enhancements"]
    N29["N29: Notes/tags tests"]
    N32["N32: Cache writer"]
    N36["N36: Deep verify"]
    N70["N70: Commit iterator"]
  end

  subgraph Phase7["Phase 7: Query (3w)"]
    N20["N20: Policy enforcement tests"]
    N33["N33: Query engine"]
  end

  subgraph Phase8["Phase 8: Final Testing (2w)"]
    N34["N34: CLI query"]
    N35["N35: Query tests"]
    N39["N39: E2E tests"]
  end

  subgraph Phase9["Phase 9: Documentation (2w)"]
    N38["N38: Documentation"]
  end

  %% Dependencies (80 edges)
  N9 --> N10
  N10 --> N11
  N9 --> N12
  N11 --> N12
  N12 --> N13
  N12 --> N14
  N13 --> N15
  N14 --> N15
  N11 --> N16
  N9 --> N17
  N9 --> N18
  N13 --> N19
  N16 --> N19
  N17 --> N19
  N18 --> N19
  N19 --> N20
  N11 --> N21
  N9 --> N22
  N22 --> N23
  N11 --> N23
  N23 --> N24
  N21 --> N25
  N17 --> N25
  N16 --> N25
  N11 --> N26
  N12 --> N26
  N11 --> N27
  N12 --> N27
  N55 --> N28
  N26 --> N28
  N27 --> N28
  N26 --> N29
  N27 --> N29
  N9 --> N30
  N30 --> N32
  N31 --> N32
  N14 --> N32
  N32 --> N33
  N33 --> N34
  N55 --> N34
  N33 --> N35
  N14 --> N36
  N23 --> N36
  N25 --> N36
  N15 --> N38
  N20 --> N38
  N29 --> N38
  N35 --> N38
  N36 --> N39
  N33 --> N39
  N70 --> N39
  N9 --> N50
  N51 --> N52
  N51 --> N53
  N52 --> N53
  N9 --> N54
  N54 --> N55
  N55 --> N56
  N55 --> N57
  N9 --> N58
  N9 --> N59
  N11 --> N60
  N9 --> N61
  N9 --> N62
  N62 --> N63
  N9 --> N64
  N59 --> N65
  N59 --> N66
  N65 --> N67
  N66 --> N67
  N10 --> N68
  N60 --> N69
  N68 --> N69
  N69 --> N70
  N61 --> N71
  N61 --> N72
  N61 --> N73
  N6 --> N9
  N7 --> N9
  N8 --> N9

  %% Styling by phase
  style N4 fill:#e8f5e9
  style N6 fill:#e8f5e9
  style N7 fill:#e8f5e9
  style N8 fill:#e8f5e9
  style N9 fill:#e8f5e9
  style N47 fill:#e8f5e9
  style N51 fill:#e8f5e9
  style N31 fill:#e8f5e9
  style N37 fill:#e8f5e9
  style N10 fill:#e3f2fd
  style N17 fill:#e3f2fd
  style N18 fill:#e3f2fd
  style N50 fill:#e3f2fd
  style N52 fill:#e3f2fd
  style N53 fill:#e3f2fd
  style N58 fill:#e3f2fd
  style N62 fill:#e3f2fd
  style N64 fill:#e3f2fd
  style N22 fill:#e3f2fd
  style N59 fill:#e3f2fd
  style N61 fill:#e3f2fd
  style N30 fill:#e3f2fd
  style N11 fill:#fff3e0
  style N54 fill:#fff3e0
  style N55 fill:#fff3e0
  style N63 fill:#fff3e0
  style N65 fill:#fff3e0
  style N66 fill:#fff3e0
  style N68 fill:#fff3e0
  style N71 fill:#fff3e0
  style N72 fill:#fff3e0
  style N73 fill:#fff3e0
  style N12 fill:#f3e5f5
  style N16 fill:#f3e5f5
  style N56 fill:#f3e5f5
  style N57 fill:#f3e5f5
  style N21 fill:#f3e5f5
  style N23 fill:#f3e5f5
  style N67 fill:#f3e5f5
  style N60 fill:#f3e5f5
  style N13 fill:#fce4ec
  style N14 fill:#fce4ec
  style N24 fill:#fce4ec
  style N25 fill:#fce4ec
  style N69 fill:#fce4ec
  style N26 fill:#fce4ec
  style N27 fill:#fce4ec
  style N15 fill:#e0f2f1
  style N19 fill:#e0f2f1
  style N70 fill:#e0f2f1
  style N28 fill:#e0f2f1
  style N29 fill:#e0f2f1
  style N32 fill:#e0f2f1
  style N36 fill:#e0f2f1
  style N20 fill:#fff9c4
  style N33 fill:#fff9c4
  style N34 fill:#ffebee
  style N35 fill:#ffebee
  style N39 fill:#ffebee
  style N38 fill:#f5f5f5

  %% Critical path highlighting (red borders)
  style N6 stroke:#d32f2f,stroke-width:4px
  style N9 stroke:#d32f2f,stroke-width:4px
  style N10 stroke:#d32f2f,stroke-width:4px
  style N11 stroke:#d32f2f,stroke-width:4px
  style N12 stroke:#d32f2f,stroke-width:4px
  style N13 stroke:#d32f2f,stroke-width:4px
  style N19 stroke:#d32f2f,stroke-width:4px
  style N20 stroke:#d32f2f,stroke-width:4px
